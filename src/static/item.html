<html lang="en">
    <head>
        <title>Steam Community Market :: Listings for Wings of Incandescent Liturgy</title>
        <meta charset="utf-8">
    </head>
    <body>  
        <h1 id="item-name"></h1>

        <div id="telemetry"></div>
        <hr>
        <div id="item-metrics"></div>
        <hr>
        <div id="item-content"></div>
        
        <script>
            // extract app_id and market_name from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const app_id = urlParams.get('app_id');
            const market_name = urlParams.get('market_name');

            document.getElementById('item-name').innerText = `${app_id} - ${market_name}`;

            function formatItem(item) {
                return `
                    <div>
                        <h2>${item.name}</h2>
                        <p>Price: ${item.price / 100.0} USD</p>
                        <p>Updated at: ${item.updated_at}</p>
                        <p>Analyzes result: ${JSON.stringify(item.analyzes_result)}</p>
                    </div>
                `;
            }

            function formatItemStats(stats) {
                let result = ``;
                // sort metrics by key
                stats = Object.fromEntries(Object.entries(stats).sort((a, b) => a[0].localeCompare(b[0])));
                for (const [key, value] of Object.entries(stats)) {
                    let first_key = Object.keys(value.result)[0];
                    result += `${key}: ${value.result[first_key].toLocaleString()}  (${value.duration_micros} µs)<br>`;
                }
                return result;
            }

            fetch('/api/item/' + app_id + '/' + market_name)
                .then(response => response.json())
                .then(data => {
                    console.log(data);

                    const telemetry = document.getElementById('telemetry');
                    telemetry.innerHTML = `Response generation duration: ${data.response_generation_duration} µs<br>`;
                    const itemMetrics = document.getElementById('item-metrics');
                    itemMetrics.innerHTML = formatItemStats(data.item_metrics);
                    const itemContent = document.getElementById('item-content');
                    itemContent.innerHTML = formatItem(data.item);
                });
 
        </script>
    </body>
</html>
